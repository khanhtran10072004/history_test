<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1.0'>
<title>L·ªãch S·ª≠ T∆∞·ªõi C√¢y</title>
<style>
 body{font-family:sans-serif; background:#f4f7f6; padding:10px; max-width:600px; margin:0 auto;}
 .card{background:#fff; padding:20px; border-radius:10px; box-shadow:0 2px 5px rgba(0,0,0,0.1);}
 h2 {text-align:center; color:#2c3e50; margin-top:0;}
 table {width:100%; border-collapse:collapse; margin-top:15px; font-size:14px;}
 th {background:#34495e; color:white; padding:10px; text-align:left;}
 td {border-bottom:1px solid #ddd; padding:12px 10px;}
 .badge-on {color:#155724; font-weight:bold; background:#d4edda; padding:5px 10px; border-radius:15px; font-size:12px;}
 .badge-off {color:#721c24; font-weight:bold; background:#f8d7da; padding:5px 10px; border-radius:15px; font-size:12px;}
 .btn-back {display:block; width:100%; padding:12px; margin-bottom:15px; background:#6c757d; color:white; text-align:center; text-decoration:none; border-radius:5px; font-weight:bold;}
 .btn-back:hover {background:#5a6268;}
 #status {text-align:center; color:gray; font-style:italic;}
</style>
</head>
<body>

<div class='card'>
 <a href="index.html" class="btn-back">‚¨Ö Quay l·∫°i B·∫£ng ƒêi·ªÅu Khi·ªÉn</a>
 <h2>üìú Nh·∫≠t K√Ω Ho·∫°t ƒê·ªông</h2>
 <div id="status">ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Cloud...</div>
 
 <table id="logTable" style="display:none;">
   <thead>
     <tr>
       <th>Th·ªùi gian</th>
       <th>Tr·∫°ng th√°i</th>
       <th>ƒê·ªô ·∫©m ƒë·∫•t</th>
     </tr>
   </thead>
   <tbody id="tableBody">
   </tbody>
 </table>
</div>

<script>
 // ƒê√É G·∫ÆN S·∫¥N LINK DATABASE C·ª¶A B·∫†N (v·ªõi l·ªánh l·∫•y 20 d√≤ng cu·ªëi)
 const DB_URL = "https://vuonthongminh-ffe93-default-rtdb.firebaseio.com/history.json?orderBy=\"$key\"&limitToLast=20";

 async function loadHistory() {
   try {
     let response = await fetch(DB_URL);
     let data = await response.json();
     
     let html = "";
     if(data) {
       // Chuy·ªÉn object th√†nh m·∫£ng
       let arr = Object.values(data);
       // ƒê·∫£o ng∆∞·ª£c ƒë·ªÉ xem m·ªõi nh·∫•t tr∆∞·ªõc
       arr.reverse(); 
       
       arr.forEach(item => {
         let isBat = item.action.includes("BAT");
         let badge = isBat 
             ? `<span class="badge-on">B·∫¨T B∆†M</span>` 
             : `<span class="badge-off">T·∫ÆT B∆†M</span>`;
         
         html += `<tr>
           <td>${item.time}</td>
           <td>${badge}</td>
           <td>${item.soil}</td>
         </tr>`;
       });
       
       document.getElementById("tableBody").innerHTML = html;
       document.getElementById("status").style.display = "none";
       document.getElementById("logTable").style.display = "table";
     } else {
       document.getElementById("status").innerText = "Ch∆∞a c√≥ d·ªØ li·ªáu l·ªãch s·ª≠ n√†o.";
     }
     
   } catch (e) {
     console.error(e);
     document.getElementById("status").innerText = "L·ªói k·∫øt n·ªëi! Ki·ªÉm tra l·∫°i Link ho·∫∑c Rules.";
   }
 }

 // T·∫£i ngay khi m·ªü v√† c·∫≠p nh·∫≠t m·ªói 5 gi√¢y
 loadHistory();
 setInterval(loadHistory, 5000);
</script>

</body>
</html>